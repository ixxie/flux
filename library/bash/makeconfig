#!/usr/bin/env bash
set -e

function makeconfig
{
    path=$(pwd)
        cd "$1"
        files=$(find "." -name "*.nix")
        files=( "./hardware-configuration.nix" ${files[@]} "./custom.nix" )
    cd "$path"

cat <<EOF > "$1/configuration.nix"
# Autogenerated configuration file built by flux.

{ config, pkgs, ... }: 

{

  imports =
    [
EOF

    printf '%s\n' "${files[@]}" >> "$1/configuration.nix"

cat <<EOF >> "$1/configuration.nix"
    ];
}
EOF

}
